{{> header}}

<h1>{{title}}</h1>

<form id="regForm">
  <label>Name:</label>
  <input id="name" required>

  <label>Email:</label>
  <input id="email" type="email" required>

  <label>Password:</label>
  <input id="password" type="password" required>

  <button type="submit">Create Account</button>
</form>

<p id="regError" style="color:red; display:none;"></p>

<script>
document.getElementById('regForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const err = document.getElementById('regError');
  err.style.display = 'none';

  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim().toLowerCase();
  const password = document.getElementById('password').value;

  try {
    const res = await fetch('/api/register', {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify({ name, email, password })
    });
    const data = await res.json();

    if (!res.ok) throw new Error(data.message || 'Registration failed');

    // success: store token + basics like we do on login
    localStorage.setItem('token', data.token);
    localStorage.setItem('role',  data.role || 'user');
    localStorage.setItem('email', email);
    sessionStorage.setItem('justRegistered', '1');
    window.location.href = '/'; // go home as logged-in
  } catch (e2) {
    err.textContent = e2.message;
    err.style.display = 'block';
  }
});
</script>

{{> footer}}