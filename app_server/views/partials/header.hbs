<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Travlr Getaways</title>
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <style>
    .hidden { display: none !important; }
  </style>
</head>

<body>
  <div id="header">
    <div id="logo">
      <a href="/"><img src="/images/logo.png" alt="LOGO" height="100" width="200"></a>
    </div>

    <div id="navigation">
      <ul class="nav navbar-nav">
        <li><a href="/travel">Travel</a></li>
        <li><a href="/news">News</a></li>
        
        <!-- Shown only when logged in -->
        <li class="auth-only hidden"><a href="/reservations">Reservations</a></li>
        <li class="auth-only hidden"><a href="#" id="logoutLink">Logout</a></li>
        
        <!-- Shown only when logged out -->
        <li class="auth-out"><a href="/login">Login</a></li>
        <li class="auth-out"><a href="/register">Register</a></li>

        <!-- Admin link: two variants; JS will toggle based on localStorage token -->
        <li id="adminOut"><a href="/admin">Admin</a></li>
        <li id="adminIn" class="hidden"><a id="adminDeepLink" href="#">Admin</a></li>
      </ul>
    </div> 
  </div>

  <script>
    function updateMenu() {
      const token = localStorage.getItem('token');
      if (token) {
        document.querySelectorAll('.auth-only').forEach(el => el.classList.remove('hidden'));
        document.querySelectorAll('.auth-out').forEach(el => el.classList.add('hidden'));
      } else {
        document.querySelectorAll('.auth-only').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.auth-out').forEach(el => el.classList.remove('hidden'));
      }

      // --- Admin link swap (this is the key part) ---
      const adminOut = document.getElementById('adminOut');
      const adminIn  = document.getElementById('adminIn');
      const deepLink = document.getElementById('adminDeepLink');

      if (token) {
        if (deepLink) deepLink.href = 'http://localhost:4200/?token=' + encodeURIComponent(token);
        if (adminOut) adminOut.classList.add('hidden');
        if (adminIn)  adminIn.classList.remove('hidden');
      } else {
        if (adminOut) adminOut.classList.remove('hidden');
        if (adminIn)  adminIn.classList.add('hidden');
        if (deepLink) deepLink.removeAttribute('href');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateMenu();
      const logout = document.getElementById('logoutLink');
      if (logout) {
        logout.addEventListener('click', (e) => {
          e.preventDefault();
          localStorage.removeItem('token');
          localStorage.removeItem('role');
          localStorage.removeItem('email');
          window.location.href = '/';
        });
      }
    });

    // Run again on page restore (e.g. back/forward navigation)
    window.addEventListener('pageshow', updateMenu);
  </script>
</body>
</html>